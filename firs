CREATE OR REPLACE FUNCTION api.get_average_temperature_reduce(city_id INTEGER, start_date DATE, end_date DATE, num_values INTEGER)
RETURNS TABLE (unix_ts TIMESTAMP WITHOUT TIME ZONE, average_temperature DOUBLE PRECISION) AS $$
BEGIN
    RETURN QUERY
    SELECT mark, AVG(temperature) AS average_temperature
    FROM data.measurement_all
    WHERE city = city_id
        AND mark >= start_date
        AND mark <= end_date
    GROUP BY mark
    ORDER BY mark
    LIMIT num_values;
END;
$$ LANGUAGE plpgsql;

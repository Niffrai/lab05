CREATE OR REPLACE FUNCTION api.count_countries_per_region()
  RETURNS TABLE (region_id INTEGER, country_count INTEGER)
AS $$
BEGIN
  RETURN QUERY
  SELECT data.region.identifier, COUNT(data.country.identifier) AS country_count
  FROM data.region
  LEFT JOIN data.country ON data.region.identifier = data.country.region_id
  GROUP BY data.region.identifier;
END;
$$ LANGUAGE plpgsql;

SELECT shape_id, COUNT(*) AS point_count
FROM (
  SELECT shape_id, COUNT(*) AS intersection_count
  FROM data.coastline
  GROUP BY shape_id, longitude, latitude
  HAVING COUNT(*) > 1
) AS intersections
GROUP BY shape_id;

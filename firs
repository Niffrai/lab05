CREATE OR REPLACE FUNCTION data.create_partition(y1 INTEGER, y2 INTEGER)
RETURNS VOID AS $$
DECLARE
    d0 TIMESTAMP;
    d1 TIMESTAMP;
BEGIN
    FOR y IN y1 .. y2 LOOP
        FOR m IN 1 .. 12 LOOP
            d0 := DATE_TRUNC('MONTH', MAKE_TIMESTAMP(y, m, 1));
            d1 := d0 + INTERVAL '1 month';
            EXECUTE FORMAT('CREATE TABLE IF NOT EXISTS data.measurement_part_y%sm%02d PARTITION OF data.measurement FOR VALUES FROM (%L) TO (%L)',
                y, m, TO_CHAR(d0, 'YYYY-MM-DD'), TO_CHAR(d1, 'YYYY-MM-DD'));
        END LOOP;
    END LOOP;
END;
$$ LANGUAGE PLPGSQL;

DROP FUNCTION IF EXISTS api.get_shape_points(integer);

CREATE OR REPLACE FUNCTION api.get_shape_points(shape_id integer)
  RETURNS TABLE (point_number integer, latitude numeric, longitude numeric) AS
$$
BEGIN
  RETURN QUERY
  WITH shape_points AS (
    SELECT segment, coastline.latitude, coastline.longitude
    FROM data.coastline
    WHERE shape = shape_id
    ORDER BY segment
  )
  SELECT ROW_NUMBER() OVER () AS point_number, latitude, longitude
  FROM shape_points;
END;
$$
LANGUAGE plpgsql;
